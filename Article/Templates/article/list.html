{% load static %}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文章列表 - 我的博客</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container py-4">
    <div class="d-flex flex-wrap align-items-center justify-content-between mb-4 gap-2">
        <div>
            <h1 class="mb-1">最新文章</h1>
            <p class="text-muted mb-0">支持分类、标签与关键词搜索</p>
        </div>
        <a class="btn btn-outline-primary" href="{% url 'Article:article_explorer' %}">探索文章</a>
    </div>

    <form class="row g-3 align-items-end mb-4" method="get">
        <div class="col-md-4">
            <label class="form-label">关键词</label>
            <input type="text" class="form-control" name="q" value="{{ search_query }}" placeholder="搜索标题、正文、标签">
        </div>
        <div class="col-md-3">
            <label class="form-label">分类</label>
            <select class="form-select" name="category">
                <option value="">全部分类</option>
                {% for category in categories %}
                <option value="{{ category.id }}" {% if category_filter == category.id|stringformat:'i' %}selected{% endif %}>
                    {{ category.name }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label">标签</label>
            <select class="form-select" name="tag">
                <option value="">全部标签</option>
                {% for tag in tags %}
                <option value="{{ tag.name }}" {% if tag_filter == tag.name %}selected{% endif %}>{{ tag.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2">
            <label class="form-label">排序</label>
            <select class="form-select" name="order">
                <option value="-created" {% if order == '-created' %}selected{% endif %}>最新</option>
                <option value="created" {% if order == 'created' %}selected{% endif %}>最早</option>
                <option value="title" {% if order == 'title' %}selected{% endif %}>标题 A-Z</option>
                <option value="-title" {% if order == '-title' %}selected{% endif %}>标题 Z-A</option>
            </select>
        </div>
        <div class="col-12">
            <button class="btn btn-primary">筛选</button>
            <a class="btn btn-link" href="{% url 'Article:article_list' %}">重置</a>
        </div>
    </form>

    {% for article in articles %}
    <div class="card mb-3 shadow-sm">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
                <div>
                    <h2 class="h4 mb-1">
                        <a class="text-decoration-none" href="{% url 'Article:article_detail' article.id %}">{{ article.title }}</a>
                    </h2>
                    <p class="text-muted mb-2">
                        作者: {{ article.author.username|default:"匿名" }}
                        · 发布于 {{ article.created|date:"Y年n月j日 G:i" }}
                        · 更新于 {{ article.updated|date:"Y年n月j日 G:i" }}
                    </p>
                </div>
                <span class="badge bg-primary">{{ article.category.name }}</span>
            </div>
            <p class="mb-2">{{ article.body|slice:":160" }}...</p>
            <div class="d-flex flex-wrap gap-2">
                {% for tag in article.tags.all %}
                <span class="badge bg-light text-dark">#{{ tag.name }}</span>
                {% empty %}
                <span class="text-muted small">暂无标签</span>
                {% endfor %}
            </div>
        </div>
    </div>
    {% empty %}
    <div class="alert alert-info">暂时还没有发布的文章。</div>
    {% endfor %}

    {% if page_obj %}
    <nav aria-label="文章分页">
        <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}&q={{ search_query }}&category={{ category_filter }}&tag={{ tag_filter }}&order={{ order }}">上一页</a>
            </li>
            {% else %}
            <li class="page-item disabled"><span class="page-link">上一页</span></li>
            {% endif %}

            <li class="page-item active"><span class="page-link">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span></li>

            {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}&q={{ search_query }}&category={{ category_filter }}&tag={{ tag_filter }}&order={{ order }}">下一页</a>
            </li>
            {% else %}
            <li class="page-item disabled"><span class="page-link">下一页</span></li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}
</div>
<script src="{% static 'tokenAdd.js' %}"></script>
<script src="{% static 'auth.js' %}"></script>
</body>
</html>
